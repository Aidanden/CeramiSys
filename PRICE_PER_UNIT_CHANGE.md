# تحويل الأسعار من سعر الصندوق إلى سعر المتر المربع

## نظرة عامة

تم تحديث النظام بحيث تصبح جميع الأسعار **للمتر المربع الواحد** بدلاً من سعر الصندوق الكامل.

## التغييرات المطبقة

### 1. Script تحويل الأسعار الموجودة

**الملف**: `/server/scripts/convert-prices-to-per-unit.ts`

**الوظيفة**:
- يجلب جميع الأسعار الموجودة في قاعدة البيانات
- يحول السعر من سعر الصندوق إلى سعر المتر المربع
- **الحساب**: `سعر المتر = سعر الصندوق ÷ عدد الأمتار في الصندوق`

**مثال**:
```
الصنف: سيراميك أبيض
السعر القديم: 216 د.ل/صندوق
عدد الأمتار في الصندوق: 1.44 م²
السعر الجديد: 216 ÷ 1.44 = 150 د.ل/م²
```

**تشغيل السكريبت**:
```bash
cd server
npm run convert:prices
```

### 2. تحديث واجهة المستخدم

**الملفات المعدلة**:
- `/client/src/app/products/page.tsx`

**التحديثات**:

#### أ. فورم إنشاء صنف جديد:
```typescript
// قبل
<label>سعر البيع</label>

// بعد
<label>سعر البيع (للمتر الواحد)</label>
<p className="text-xs text-gray-500 mt-1">
  أدخل سعر المتر الواحد (ليس سعر الصندوق)
</p>
```

#### ب. فورم تحديث السعر:
```typescript
// قبل
<label>السعر الجديد *</label>

// بعد
<label>السعر الجديد (للمتر الواحد) *</label>
<p className="text-xs text-gray-500 mt-1">
  أدخل سعر المتر الواحد (ليس سعر الصندوق)
</p>
```

#### ج. عنوان جدول الأصناف:
```typescript
// قبل
<th>السعر</th>

// بعد
<th>السعر (د.ل/م²)</th>
```

#### د. مودال تفاصيل السعر:
```typescript
// قبل
<span>السعر الحالي:</span>
<span>{price} د.ل</span>

// بعد
<span>السعر الحالي (للمتر المربع):</span>
<span>{price} د.ل/م²</span>

// إضافة حساب سعر الصندوق
<span>سعر الصندوق الكامل:</span>
<span>{price × unitsPerBox} د.ل/صندوق</span>
```

#### هـ. QR Code:
```html
<!-- قبل -->
<div>السعر: 150 د.ل</div>

<!-- بعد -->
<div>السعر: 150 د.ل/م²</div>
```

### 3. منطق النظام

#### الأصناف الجديدة:
- المستخدم يدخل سعر المتر المربع مباشرة
- يتم حفظ السعر كما هو في قاعدة البيانات
- **لا حاجة لتحويل**

#### تحديث الأسعار:
- المستخدم يدخل سعر المتر المربع الجديد
- يتم تحديث السعر مباشرة
- **لا حاجة لتحويل**

#### عرض الأسعار:
- جميع الأسعار تُعرض بوحدة "د.ل/م²"
- في حالة الأصناف بوحدة "صندوق"، يتم حساب سعر الصندوق الكامل للعرض فقط

## أمثلة عملية

### مثال 1: صنف موجود
```
الصنف: سيراميك أزرق
السعر القديم: 288 د.ل/صندوق
عدد الأمتار: 1.44 م²/صندوق

بعد التحويل:
السعر الجديد: 200 د.ل/م²
سعر الصندوق: 200 × 1.44 = 288 د.ل/صندوق ✅
```

### مثال 2: صنف جديد
```
المستخدم يدخل:
- اسم الصنف: سيراميك أخضر
- عدد الأمتار: 1.44 م²/صندوق
- السعر: 175 د.ل/م² ← للمتر الواحد

النتيجة:
- يُحفظ: 175 د.ل/م²
- سعر الصندوق: 175 × 1.44 = 252 د.ل/صندوق
```

## الفوائد

### 1. للمستخدم:
- **وضوح أكبر**: السعر للمتر المربع أوضح من سعر الصندوق
- **سهولة المقارنة**: يمكن مقارنة أسعار الأصناف بسهولة
- **مرونة في التسعير**: يمكن تسعير كميات مختلفة بدقة

### 2. للنظام:
- **اتساق البيانات**: جميع الأسعار بنفس الوحدة
- **سهولة الحسابات**: حسابات الفواتير أبسط
- **قابلية التوسع**: يمكن إضافة أصناف بأحجام صناديق مختلفة

## الملفات المعدلة

### Backend:
- `/server/scripts/convert-prices-to-per-unit.ts` - سكريبت التحويل
- `/server/package.json` - إضافة npm script

### Frontend:
- `/client/src/app/products/page.tsx` - تحديث واجهة المستخدم

## التشغيل

### 1. تحويل الأسعار الموجودة (مرة واحدة فقط):
```bash
cd server
npm run convert:prices
```

### 2. استخدام النظام:
- إنشاء أصناف جديدة: أدخل سعر المتر المربع
- تحديث الأسعار: أدخل سعر المتر المربع الجديد
- عرض الأسعار: جميع الأسعار بوحدة "د.ل/م²"

## ملاحظات مهمة

### ⚠️ تحذيرات:
1. **تشغيل السكريبت مرة واحدة فقط**: لا تشغل `convert:prices` أكثر من مرة
2. **نسخة احتياطية**: تأكد من عمل backup لقاعدة البيانات قبل التحويل
3. **التحقق**: تحقق من الأسعار بعد التحويل للتأكد من صحتها

### ✅ التأكيدات:
1. **جميع الأسعار الجديدة**: للمتر المربع
2. **الحسابات صحيحة**: سعر الصندوق = سعر المتر × عدد الأمتار
3. **الواجهة واضحة**: جميع النصوص توضح أن السعر للمتر المربع

## اختبار النظام

### 1. اختبار الأسعار الموجودة:
```bash
# تشغيل السكريبت
npm run convert:prices

# التحقق من النتائج في قاعدة البيانات
# السعر الجديد = السعر القديم ÷ unitsPerBox
```

### 2. اختبار الأصناف الجديدة:
1. أنشئ صنف جديد بوحدة "صندوق"
2. أدخل عدد الأمتار: 1.44
3. أدخل السعر: 150 د.ل/م²
4. تحقق: سعر الصندوق = 150 × 1.44 = 216 د.ل

### 3. اختبار تحديث الأسعار:
1. اختر صنف موجود
2. اضغط على أيقونة السعر
3. أدخل سعر جديد: 200 د.ل/م²
4. تحقق: السعر محدث والحسابات صحيحة

---

**تاريخ التطبيق**: أكتوبر 2025  
**الإصدار**: 1.0  
**الحالة**: مطبق ✅
