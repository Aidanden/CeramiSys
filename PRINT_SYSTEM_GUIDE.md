# دليل نظام الطباعة - CeramiSys 🖨️

## نظرة عامة

تم إضافة نظام طباعة احترافي يشمل:
1. **فاتورة المبيعات** - مع تفاصيل الأصناف والأمتار المربعة
2. **إيصال قبض نقدي** - يُطبع تلقائياً مع الفواتير النقدية
3. **معاينة قبل الطباعة** - لمراجعة المستندات قبل الطباعة

## المميزات الرئيسية

### 1. فاتورة المبيعات 📄

#### المحتوى:
- **رأس الفاتورة**:
  - اسم الشركة وكودها
  - رقم الفاتورة
  - التاريخ والوقت

- **معلومات العميل**:
  - اسم العميل
  - رقم الهاتف (إن وجد)
  - نوع البيع (نقدي/آجل)
  - طريقة الدفع (كاش/حوالة/بطاقة)

- **جدول الأصناف**:
  - رقم تسلسلي
  - اسم الصنف وكوده
  - الكمية بالصناديق
  - **الأمتار المربعة** (للأصناف المباعة بالصندوق)
  - الوحدة (صندوق/متر/قطعة)
  - السعر
  - الإجمالي

- **المجموع الإجمالي**
- **التوقيعات**: المحاسب، المدير، العميل

#### مثال على عرض الأمتار:
```
الكمية: 10 صناديق
        (60 م²)  ← إذا كان الصندوق = 6 متر مربع
```

### 2. إيصال القبض النقدي 💵

#### يُطبع فقط للفواتير النقدية (CASH)

#### المحتوى:
- **رأس الإيصال**:
  - اسم الشركة
  - "إيصال قبض نقدي" بتصميم مميز

- **معلومات الإيصال**:
  - رقم الإيصال (نفس رقم الفاتورة)
  - التاريخ والوقت
  - طريقة الدفع

- **معلومات الدافع**:
  - "استلمنا من السيد/ة: [اسم العميل]"
  - رقم الهاتف

- **المبلغ**:
  - المبلغ بالأرقام (كبير ومميز)
  - المبلغ بالحروف: "فقط: خمسمائة دينار لا غير"

- **السبب**:
  - "وذلك عن: قيمة فاتورة مبيعات رقم..."

- **التوقيعات**: المستلم، الدافع

### 3. نظام التحويل للحروف

تم تطبيق نظام ذكي لتحويل الأرقام إلى كلمات عربية:

```typescript
500.750 د.ل → "خمسمائة دينار و750 درهم"
1250 د.ل → "ألف ومائتان وخمسون دينار"
```

## كيفية الاستخدام

### 1. من صفحة المبيعات:

```
1. اذهب إلى صفحة المبيعات
2. اضغط على زر 🖨️ (طباعة) بجانب الفاتورة
3. ستظهر نافذة المعاينة
4. راجع المستندات
5. اضغط "طباعة"
```

### 2. ما سيتم طباعته:

#### للفواتير النقدية (CASH):
- ✅ فاتورة المبيعات (صفحة كاملة)
- ✅ إيصال القبض (صفحة منفصلة)

#### للفواتير الآجلة (CREDIT):
- ✅ فاتورة المبيعات فقط
- ⚠️ إيصال القبض غير متاح

## الملفات المضافة

### 1. مكونات الطباعة:

```
/client/src/components/sales/
├── InvoicePrint.tsx      # مكون طباعة الفاتورة
├── ReceiptPrint.tsx      # مكون طباعة إيصال القبض
└── PrintModal.tsx        # مودال المعاينة والطباعة
```

### 2. الأنماط:

```
/client/src/styles/
└── print.css             # أنماط الطباعة
```

### 3. التحديثات:

```
/client/src/app/
├── layout.tsx            # إضافة print.css
└── sales/page.tsx        # إضافة زر الطباعة ومودال
```

## التفاصيل التقنية

### 1. InvoicePrint.tsx

```typescript
// عرض الأمتار المربعة للأصناف بالصندوق
{isBox && totalUnits > 0 && (
  <div style={{ fontSize: '11px', color: '#666', marginTop: '3px' }}>
    ({formatArabicNumber(totalUnits)} م²)
  </div>
)}
```

### 2. ReceiptPrint.tsx

```typescript
// تحويل الرقم إلى كلمات عربية
const numberToArabicWords = (num: number): string => {
  // منطق التحويل...
  return "خمسمائة دينار و750 درهم";
};
```

### 3. PrintModal.tsx

```typescript
// الطباعة باستخدام window.print()
const handlePrint = () => {
  window.print();
};
```

### 4. print.css

```css
@media print {
  /* إخفاء كل شيء ما عدا محتوى الطباعة */
  body * {
    visibility: hidden;
  }

  /* إظهار محتوى الطباعة فقط */
  .print-invoice,
  .print-receipt {
    visibility: visible;
  }

  /* صفحة منفصلة لإيصال القبض */
  .print-receipt {
    page-break-before: always;
  }
}
```

## التصميم والألوان

### فاتورة المبيعات:
- **رأس الفاتورة**: أزرق (#1e40af)
- **الجدول**: رأس أزرق، صفوف بيضاء
- **المجموع**: أخضر (#16a34a)
- **ملاحظات**: خلفية صفراء (#fef3c7)

### إيصال القبض:
- **رأس الإيصال**: أخضر (#16a34a)
- **معلومات الدافع**: خلفية صفراء (#fef3c7)
- **المبلغ**: خلفية زرقاء فاتحة (#dbeafe)
- **حدود**: إطار مزدوج (#333)

## الأمتار المربعة في الفاتورة

### كيف يتم الحساب:

```typescript
const isBox = line.product?.unit === 'صندوق';
const unitsPerBox = line.product?.unitsPerBox || 0;
const totalUnits = isBox && unitsPerBox > 0 
  ? line.qty * unitsPerBox 
  : 0;
```

### مثال:
- **الصنف**: بلاط سيراميك IKOM BLANCO
- **الوحدة**: صندوق
- **الوحدات في الصندوق**: 6 متر مربع
- **الكمية المباعة**: 10 صناديق

**العرض في الفاتورة**:
```
الكمية: 10 صندوق
        (60 م²)
```

## إعدادات الطباعة

### حجم الورق:
- **A4** (210mm × 297mm)

### الهوامش:
- **20mm** من جميع الجوانب

### الخطوط:
- **Arial** (يدعم العربية)
- **أحجام متنوعة**: 13px - 32px

### الاتجاه:
- **RTL** (من اليمين لليسار)

## الاختبار

### 1. اختبار فاتورة نقدية:
```
1. أنشئ فاتورة مبيعات نقدية
2. أضف أصناف بالصندوق (لها unitsPerBox)
3. اضغط زر الطباعة
4. تحقق من:
   ✓ ظهور الأمتار المربعة
   ✓ ظهور إيصال القبض
   ✓ المبلغ بالحروف صحيح
```

### 2. اختبار فاتورة آجلة:
```
1. أنشئ فاتورة مبيعات آجلة
2. اضغط زر الطباعة
3. تحقق من:
   ✓ ظهور الفاتورة فقط
   ✓ عدم ظهور إيصال القبض
   ✓ رسالة توضيحية في المعاينة
```

## الميزات الإضافية

### 1. معاينة قبل الطباعة:
- عرض مصغر للمستندات
- معلومات توضيحية
- إمكانية الإلغاء

### 2. تنسيق الأرقام:
- أرقام عربية (0-9)
- فواصل الآلاف
- منازل عشرية للأسعار

### 3. التوقيعات:
- مساحات للتوقيع
- أسماء الموقعين
- تصميم احترافي

### 4. الختم:
- تاريخ ووقت الطباعة
- رسالة شكر
- معلومات إضافية

## استكشاف الأخطاء

### المشكلة: لا تظهر الأمتار المربعة
**الحل**: تأكد من أن:
- الصنف وحدته "صندوق"
- الصنف له `unitsPerBox` > 0

### المشكلة: لا يظهر إيصال القبض
**الحل**: تأكد من أن:
- نوع البيع "نقدي" (CASH)
- ليس "آجل" (CREDIT)

### المشكلة: الطباعة لا تعمل
**الحل**:
1. تأكد من تثبيت print.css
2. تحقق من إعدادات المتصفح
3. جرب متصفح آخر

## التطوير المستقبلي

### أفكار للتحسين:
- [ ] إضافة شعار الشركة
- [ ] خيارات تخصيص التصميم
- [ ] حفظ كـ PDF
- [ ] إرسال بالبريد الإلكتروني
- [ ] طباعة دفعة من الفواتير
- [ ] قوالب متعددة للفواتير

## الخلاصة

✅ **نظام طباعة كامل ومتكامل**
✅ **فاتورة مع تفاصيل الأمتار**
✅ **إيصال قبض للفواتير النقدية**
✅ **تصميم احترافي وجميل**
✅ **سهل الاستخدام**
✅ **جاهز للإنتاج**

---

**تم التطوير بواسطة**: CeramiSys Team
**التاريخ**: 2025-09-30
**الإصدار**: 1.0.0
