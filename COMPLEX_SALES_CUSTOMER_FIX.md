# ุฅุตูุงุญ ููุทู ุงูุนููู ูู ุงููุจูุนุงุช ุงููุนูุฏุฉ

## โ ุงููุดููุฉ ุงูุฃุณุงุณูุฉ:

ูุงู ุงููุธุงู ูุณุฌู **ุงูุนููู ุงูููุงุฆู** ูู ููุง ุงููุงุชูุฑุชูู:
```
ูุงุชูุฑุฉ ุงูุฃู (ุงูุชูุงุฒู) โ ุงูุนููู ุงูููุงุฆู โ
ูุงุชูุฑุฉ ุงููุฑุน (ุงูุฅูุงุฑุงุช) โ ุงูุนููู ุงูููุงุฆู โ
```

ูุฐุง ุฎุงุทุฆ ูุฃู ุงูุดุฑูุฉ ุงูุฃู ุชุจูุน ููุดุฑูุฉ ุงููุฑุนูุฉุ ูููุณ ููุนููู ุงูููุงุฆู ูุจุงุดุฑุฉ.

---

## โ ุงูุญู ุงููุทุจู:

### ุงูููุทู ุงูุตุญูุญ:
```
ูุงุชูุฑุฉ ุงูุฃู (ุงูุชูุงุฒู) โ ุงูุดุฑูุฉ ุงููุฑุนูุฉ (ูุนููู) โ
ูุงุชูุฑุฉ ุงููุฑุน (ุงูุฅูุงุฑุงุช) โ ุงูุนููู ุงูููุงุฆู โ
```

### ุงูุชุทุจูู:
1. **ุฅูุดุงุก ุนููู ูููู** ููุซู ุงูุดุฑูุฉ ุงููุฑุนูุฉ
2. **ุงุณุชุฎุฏุงู ูุฐุง ุงูุนููู** ูู ูุงุชูุฑุฉ ุงูุดุฑูุฉ ุงูุฃู
3. **ุงุณุชุฎุฏุงู ุงูุนููู ุงูุญูููู** ูู ูุงุชูุฑุฉ ุงููุฑุน

---

## ๐ง ุงูููุฏ ุงููุทุจู:

### 1. ุฅูุดุงุก/ุงูุญุตูู ุนูู ุนููู ููุซู ุงูุดุฑูุฉ ุงููุฑุนูุฉ:
```typescript
// ุงูุจุญุซ ุนู ุนููู ุจููุณ ุงุณู ุงูุดุฑูุฉ ุงููุฑุนูุฉ
let branchAsCustomer = await tx.customer.findFirst({
  where: {
    name: branchCompany.name,
    phone: `BRANCH-${data.branchCompanyId}` // ูุนุฑู ูุฑูุฏ
  }
});

// ุฅุฐุง ูู ููุฌุฏุ ุฃูุดุฆู
if (!branchAsCustomer) {
  branchAsCustomer = await tx.customer.create({
    data: {
      name: branchCompany.name,
      phone: `BRANCH-${data.branchCompanyId}`,
      note: `ุนููู ูููู ููุซู ุงูุดุฑูุฉ ุงููุฑุนูุฉ: ${branchCompany.name}`
    }
  });
}
```

### 2. ุงุณุชุฎุฏุงู ุงูุนููู ุงูุตุญูุญ ูู ูู ูุงุชูุฑุฉ:
```typescript
// ูุงุชูุฑุฉ ุงูุฃู โ ุงููุฑุน
const parentSale = await tx.sale.create({
  data: {
    companyId: data.parentCompanyId,
    customerId: branchAsCustomer.id, // โ ุงูุดุฑูุฉ ุงููุฑุนูุฉ ูุนููู
    // ... ุจุงูู ุงูุจูุงูุงุช
  }
});

// ูุงุชูุฑุฉ ุงููุฑุน โ ุงูุนููู ุงูููุงุฆู
const customerSale = await tx.sale.create({
  data: {
    companyId: data.branchCompanyId,
    customerId: data.customerId, // โ ุงูุนููู ุงูุญูููู
    // ... ุจุงูู ุงูุจูุงูุงุช
  }
});
```

---

## ๐ ูุซุงู ุนููู:

### ุงูุณููุงุฑูู:
```
ุงูุดุฑูุฉ ุงูุฃู: ุดุฑูุฉ ุงูุชูุงุฒู (ID: 1)
ุงูุดุฑูุฉ ุงููุฑุนูุฉ: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ID: 2)
ุงูุนููู ุงูููุงุฆู: ูุญูุฏ ุฃุญูุฏ (ID: 5)
```

### ุงููุชูุฌุฉ:
```
1. ูุชู ุฅูุดุงุก/ุงูุญุตูู ุนูู ุนููู ูููู:
   - ุงูุงุณู: ุดุฑูุฉ ุงูุฅูุงุฑุงุช
   - ุงููุงุชู: BRANCH-2
   - ุงูููุงุญุธุฉ: ุนููู ูููู ููุซู ุงูุดุฑูุฉ ุงููุฑุนูุฉ

2. ูุงุชูุฑุฉ ุงูุฃู (ุงูุชูุงุฒู):
   - ุงูุจุงุฆุน: ุดุฑูุฉ ุงูุชูุงุฒู (ID: 1)
   - ุงูุนููู: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ุนููู ูููู)
   - ุงูููุน: ุขุฌู
   - ุงููุจูุบ: 1000 ุฏ.ู

3. ูุงุชูุฑุฉ ุงููุฑุน (ุงูุฅูุงุฑุงุช):
   - ุงูุจุงุฆุน: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ID: 2)
   - ุงูุนููู: ูุญูุฏ ุฃุญูุฏ (ID: 5)
   - ุงูููุน: ููุฏู/ุขุฌู (ุญุณุจ ุงูุงุฎุชูุงุฑ)
   - ุงููุจูุบ: 1200 ุฏ.ู (ูุน ูุงูุด ุงูุฑุจุญ)
```

---

## ๐ก ุงูููุงุฆุฏ:

### 1. **ููุทู ุตุญูุญ**:
- ุงูุดุฑูุฉ ุงูุฃู ุชุจูุน ูููุฑุน (ูููุณ ููุนููู ุงูููุงุฆู)
- ุงููุฑุน ูุจูุน ููุนููู ุงูููุงุฆู
- ูู ูุงุชูุฑุฉ ููุง ุงูุนููู ุงูุตุญูุญ

### 2. **ุชุชุจุน ุฏููู**:
- ูููู ุชุชุจุน ุงููุจูุนุงุช ุจูู ุงูุดุฑูุงุช
- ูููู ูุนุฑูุฉ ุฏููู ุงูุดุฑูุงุช ุงููุฑุนูุฉ ููุฃู
- ุชูุงุฑูุฑ ูุงุถุญุฉ ููู ูุณุชูู

### 3. **ุนููู ูููู ุฐูู**:
- ูุชู ุฅูุดุงุคู ุชููุงุฆูุงู ุนูุฏ ุงูุญุงุฌุฉ
- ูุนุฑู ูุฑูุฏ: `BRANCH-{companyId}`
- ููุงุญุธุฉ ุชูุถูุญูุฉ ููุชูููุฒ

### 4. **ูุง ุชูุฑุงุฑ**:
- ุฅุฐุง ูุงู ุงูุนููู ุงููููู ููุฌูุฏุงูุ ูุชู ุงุณุชุฎุฏุงูู
- ูุง ูุชู ุฅูุดุงุก ุนููุงุก ููุฑุฑูู

---

## ๐งช ุงูุงุฎุชุจุงุฑ:

### 1. ุฅูุดุงุก ุนูููุฉ ุจูุน ูุนูุฏุฉ:
```
ุงูุนููู: ูุญูุฏ ุฃุญูุฏ
ุงูุดุฑูุฉ ุงููุฑุนูุฉ: ุดุฑูุฉ ุงูุฅูุงุฑุงุช
ุงูุดุฑูุฉ ุงูุฃู: ุดุฑูุฉ ุงูุชูุงุฒู
```

### 2. ุงูุชุญูู ูู ุงูููุงุชูุฑ:
```sql
-- ูุงุชูุฑุฉ ุงูุฃู
SELECT * FROM Sale 
WHERE companyId = 1 -- ุงูุชูุงุฒู
AND invoiceNumber LIKE 'PR-%';

-- ูุฌุจ ุฃู ูููู customerId = ุนููู ูููู (ุดุฑูุฉ ุงูุฅูุงุฑุงุช)

-- ูุงุชูุฑุฉ ุงููุฑุน
SELECT * FROM Sale 
WHERE companyId = 2 -- ุงูุฅูุงุฑุงุช
AND invoiceNumber LIKE 'BR-%';

-- ูุฌุจ ุฃู ูููู customerId = 5 (ูุญูุฏ ุฃุญูุฏ)
```

### 3. ุงูุชุญูู ูู ุงูุนููู ุงููููู:
```sql
SELECT * FROM Customer 
WHERE phone LIKE 'BRANCH-%';

-- ูุฌุจ ุฃู ูุธูุฑ ุนููู ุจุงุณู "ุดุฑูุฉ ุงูุฅูุงุฑุงุช"
```

---

## ๐ ุงูููู ุงููุญุฏุซ:
- โ `/server/src/services/ComplexInterCompanySaleService.ts`

---

## โจ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

ุงูุขู ุงููุธุงู ูุนูู ุจุงูููุทู ุงูุตุญูุญ:
- โ ูุงุชูุฑุฉ ุงูุฃู โ ุงูุดุฑูุฉ ุงููุฑุนูุฉ (ูุนููู)
- โ ูุงุชูุฑุฉ ุงููุฑุน โ ุงูุนููู ุงูุญูููู
- โ ุนููู ูููู ูููุดุฃ ุชููุงุฆูุงู
- โ ูุง ุชูุฑุงุฑ ูู ุงูุนููุงุก ุงููููููู
- โ ุชุชุจุน ุฏููู ูููุจูุนุงุช ุจูู ุงูุดุฑูุงุช

**ุงููุธุงู ุงูุขู ูุนูู ุจุดูู ุตุญูุญ ูููุทูู!** ๐
