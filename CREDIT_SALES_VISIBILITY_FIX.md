# ุฅุตูุงุญ ุธููุฑ ุงููุจูุนุงุช ุงูุขุฌูุฉ ูู ุงูุดุฑูุฉ ุงูุฃู

## โ ุงููุดููุฉ:

ูุงุชูุฑุฉ ุงูุดุฑูุฉ ุงูุฃู (ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช) **ูุง ุชุธูุฑ** ูู ุดุงุดุฉ ุงููุจูุนุงุช ุงูุขุฌูุฉ ููุณุชุฎุฏู ุดุฑูุฉ ุงูุฅูุงุฑุงุช.

### ุงูุณุจุจ:
```typescript
// ุงูููุฏ ุงููุฏูู
const where: any = {
  saleType: 'CREDIT',
  ...(isSystemUser !== true && { companyId: userCompanyId })
};
```

ูุฐุง ูุนูู ุฃู ุงููุณุชุฎุฏู ูุฑู ููุท ุงููุจูุนุงุช ุงูุขุฌูุฉ ุงูุชู **ุดุฑูุชู ูู ุงูุจุงุฆุน**.

ููู ูู ูุงุชูุฑุฉ ุงูุฃู:
- **ุงูุจุงุฆุน**: ุดุฑูุฉ ุงูุชูุงุฒู (ุงูุฃู)
- **ุงูุนููู**: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ูุนููู ูููู)

ููู ุชุธูุฑ ููุณุชุฎุฏู ุดุฑูุฉ ุงูุฅูุงุฑุงุช!

---

## โ ุงูุญู ุงููุทุจู:

### ุงูููุทู ุงูุฌุฏูุฏ:
ูุฌุจ ุฃู ูุฑู ุงููุณุชุฎุฏู ุงููุจูุนุงุช ุงูุขุฌูุฉ ุงูุชู:
1. **ุดุฑูุชู ูู ุงูุจุงุฆุน** (companyId = userCompanyId)
2. **ุฃู ุดุฑูุชู ูู ุงูุนููู** (customerId = ุนููู ูููู ููุซู ุงูุดุฑูุฉ)

### ุงูููุฏ ุงููุทุจู:

```typescript
// ุจูุงุก ุดุฑูุท ุงูุจุญุซ
const where: any = {
  saleType: 'CREDIT',
};

// ูููุณุชุฎุฏููู ุงูุนุงุฏููู
if (isSystemUser !== true) {
  // ุงูุจุญุซ ุนู ุนููู ูููู ููุซู ุดุฑูุฉ ุงููุณุชุฎุฏู
  const branchAsCustomer = await this.prisma.customer.findFirst({
    where: {
      phone: `BRANCH-${userCompanyId}`
    }
  });

  // ุฅุธูุงุฑ ุงููุจูุนุงุช ุงูุชู:
  // 1. ุดุฑูุฉ ุงููุณุชุฎุฏู ูู ุงูุจุงุฆุน
  // 2. ุฃู ุดุฑูุฉ ุงููุณุชุฎุฏู ูู ุงูุนููู (ูููุจูุนุงุช ูู ุงูุดุฑูุฉ ุงูุฃู)
  const companyConditions = [
    { companyId: userCompanyId },
    ...(branchAsCustomer ? [{ customerId: branchAsCustomer.id }] : [])
  ];

  // ุฏูุฌ ูุน ุดุฑูุท ุงูุจุญุซ ุฅุฐุง ูุฌุฏุช
  if (search) {
    where.AND = [
      { OR: companyConditions },
      {
        OR: [
          { invoiceNumber: { contains: search } },
          { customer: { name: { contains: search } } }
        ]
      }
    ];
  } else {
    where.OR = companyConditions;
  }
}
```

---

## ๐ ูุซุงู ุนููู:

### ุงูุณููุงุฑูู:
```
ูุณุชุฎุฏู: ููุธู ูู ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ID: 2)
```

### ุงูููุงุชูุฑ ุงูุขุฌูุฉ ุงูุชู ูุฌุจ ุฃู ูุฑุงูุง:

#### 1. ููุงุชูุฑ ุดุฑูุชู ูุจุงุฆุน:
```
ุงููุงุชูุฑุฉ: BR-2-123456
ุงูุจุงุฆุน: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ID: 2)
ุงูุนููู: ูุญูุฏ ุฃุญูุฏ
ุงูููุน: ุขุฌู
```
โ **ูุธูุฑ** ูุฃู `companyId = 2`

#### 2. ููุงุชูุฑ ูู ุงูุดุฑูุฉ ุงูุฃู:
```
ุงููุงุชูุฑุฉ: PR-1-123456
ุงูุจุงุฆุน: ุดุฑูุฉ ุงูุชูุงุฒู (ID: 1)
ุงูุนููู: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ุนููู ูููู)
ุงูููุน: ุขุฌู
```
โ **ูุธูุฑ ุงูุขู** ูุฃู `customerId = ุนููู ูููู (ุดุฑูุฉ ุงูุฅูุงุฑุงุช)`

#### 3. ููุงุชูุฑ ุดุฑูุงุช ุฃุฎุฑู:
```
ุงููุงุชูุฑุฉ: BR-3-123456
ุงูุจุงุฆุน: ุดุฑูุฉ ุฃุฎุฑู (ID: 3)
ุงูุนููู: ุนููู ุขุฎุฑ
ุงูููุน: ุขุฌู
```
โ **ูุง ูุธูุฑ** - ููุณ ูู ุนูุงูุฉ ุจุดุฑูุฉ ุงููุณุชุฎุฏู

---

## ๐ง ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ:

### 1. ุฏุงูุฉ getCreditSales:
- โ ุฅุถุงูุฉ ุงูุจุญุซ ุนู ุงูุนููู ุงููููู
- โ ุฅุถุงูุฉ ุดุฑุท OR ููุจุงุฆุน ุฃู ุงูุนููู
- โ ุฏูุฌ ุตุญูุญ ูุน ุดุฑูุท ุงูุจุญุซ

### 2. ุฏุงูุฉ getCreditSalesStats:
- โ ููุณ ุงูููุทู ููุฅุญุตุงุฆูุงุช
- โ ุงูุฅุญุตุงุฆูุงุช ุชุดูู ุงูููุงุชูุฑ ูู ุงูุฃู

---

## ๐ก ุงูููุงุฆุฏ:

### 1. **ุฑุคูุฉ ูุงููุฉ ููุฏููู**:
- ุงููุฑุน ูุฑู ุฏูููู ููุดุฑูุฉ ุงูุฃู
- ุงููุฑุน ูุฑู ุฏููู ุนููุงุฆู ูู

### 2. **ุฅุฏุงุฑุฉ ุฃูุถู**:
- ูุชุงุจุนุฉ ุงููุฏููุนุงุช ููุดุฑูุฉ ุงูุฃู
- ูุชุงุจุนุฉ ุงููุฏููุนุงุช ูู ุงูุนููุงุก
- ูู ุดูุก ูู ููุงู ูุงุญุฏ

### 3. **ุชูุงุฑูุฑ ุฏูููุฉ**:
- ุงูุฅุญุตุงุฆูุงุช ุชุดูู ุฌููุน ุงูุฏููู
- ูุง ูุนูููุงุช ูุฎููุฉ
- ุตูุฑุฉ ูุงููุฉ ูููุถุน ุงููุงูู

---

## ๐งช ุงูุงุฎุชุจุงุฑ:

### 1. ุฅูุดุงุก ุนูููุฉ ุจูุน ูุนูุฏุฉ:
```
ุงูุดุฑูุฉ ุงูุฃู: ุงูุชูุงุฒู
ุงูุดุฑูุฉ ุงููุฑุนูุฉ: ุงูุฅูุงุฑุงุช
ุงูุนููู: ูุญูุฏ ุฃุญูุฏ
```

### 2. ุชุณุฌูู ุงูุฏุฎูู ููุณุชุฎุฏู ุงูุฅูุงุฑุงุช:
```
ุงูุฐูุงุจ ูุดุงุดุฉ ุงููุจูุนุงุช ุงูุขุฌูุฉ
```

### 3. ุงูุชุญูู:
```sql
-- ูุฌุจ ุฃู ุชุธูุฑ ูุงุชูุฑุชุงู:

1. ูุงุชูุฑุฉ ูู ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช (ุขุฌู)
   - ุงูุจุงุฆุน: ุงูุชูุงุฒู
   - ุงูุนููู: ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ูููู)
   - ุงููุจูุบ: 1000 ุฏ.ู
   - ุงูุญุงูุฉ: ุบูุฑ ูุฏููุน

2. ูุงุชูุฑุฉ ูู ุงูุฅูุงุฑุงุช โ ูุญูุฏ ุฃุญูุฏ
   - ุงูุจุงุฆุน: ุงูุฅูุงุฑุงุช
   - ุงูุนููู: ูุญูุฏ ุฃุญูุฏ
   - ุงููุจูุบ: 1200 ุฏ.ู
   - ุงูุญุงูุฉ: ุญุณุจ ุงูุงุฎุชูุงุฑ (ููุฏู/ุขุฌู)
```

---

## ๐ ุงูููู ุงููุญุฏุซ:
- โ `/server/src/services/SalePaymentService.ts`
  - ุฏุงูุฉ `getCreditSales()`
  - ุฏุงูุฉ `getCreditSalesStats()`

---

## โจ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

ุงูุขู ุดุงุดุฉ ุงููุจูุนุงุช ุงูุขุฌูุฉ ุชุนุฑุถ:
- โ **ุงููุจูุนุงุช ุงูุชู ุงูุดุฑูุฉ ุจุงุฆุน ูููุง**
- โ **ุงููุจูุนุงุช ุงูุชู ุงูุดุฑูุฉ ุนููู ูููุง** (ูู ุงูุดุฑูุฉ ุงูุฃู)
- โ **ุฅุญุตุงุฆูุงุช ุดุงููุฉ** ูุฌููุน ุงูุฏููู
- โ **ุฑุคูุฉ ูุงููุฉ** ูููุถุน ุงููุงูู

**ุงููุธุงู ุงูุขู ูุนูู ุจุดูู ุตุญูุญ ูููุทูู!** ๐
