# دليل حل مشاكل شاشة المشتريات

## المشكلة: "يجب اختيار الشركة أولاً"

### 🔍 التشخيص

إذا كانت شاشة المشتريات تظهر رسالة "يجب اختيار الشركة أولاً" ولا تعمل بشكل صحيح، فهذا يعني أن هناك مشكلة في تحميل الشركات أو في اختيار الشركة.

### 🛠️ الحلول المتاحة

#### الحل الأول: استخدام النسخة المحسنة (الافتراضية)
الملف: `client/src/app/purchases/page.tsx`

**الميزات:**
- ✅ رسائل خطأ واضحة
- ✅ معلومات تشخيصية في console
- ✅ أزرار إعادة التحميل
- ✅ روابط سريعة لإدارة الشركات
- ✅ معالجة جميع حالات الخطأ

#### الحل الثاني: استخدام النسخة المبسطة
الملف: `client/src/app/purchases/page-simple.tsx`

**الميزات:**
- ✅ واجهة مبسطة
- ✅ معالجة أفضل للأخطاء
- ✅ رسائل واضحة للمستخدم
- ✅ أزرار إعادة التحميل

### 🔧 خطوات التشخيص

#### 1. فتح Developer Tools
```bash
F12 أو Ctrl+Shift+I
```

#### 2. فحص Console
ابحث عن الرسائل التالية:
```
🔍 Purchases Debug: {
  selectedCompanyId: null,
  companiesData: undefined,
  isLoadingCompanies: true,
  companiesError: null,
  hasCompanies: 0
}
```

#### 3. فحص Network Tab
- تحقق من طلبات API للشركات
- تأكد من أن `/api/company` يعمل بشكل صحيح
- تحقق من رؤوس الطلبات (Headers)

### 🚨 الأخطاء الشائعة وحلولها

#### خطأ 1: "خطأ في تحميل الشركات"
**السبب:** مشكلة في API الشركات
**الحل:**
1. تحقق من أن الباك إند يعمل
2. تحقق من endpoint `/api/company`
3. تحقق من الصلاحيات

#### خطأ 2: "لا توجد شركات متاحة"
**السبب:** لا توجد شركات في قاعدة البيانات
**الحل:**
1. اذهب إلى صفحة إدارة الشركات
2. أضف شركة جديدة
3. تأكد من حفظها بنجاح

#### خطأ 3: "خطأ غير معروف"
**السبب:** مشكلة في الشبكة أو المصادقة
**الحل:**
1. تحقق من اتصال الإنترنت
2. تأكد من تسجيل الدخول
3. أعد تحميل الصفحة

### 🔄 كيفية التبديل بين النسخ

#### للتبديل إلى النسخة المبسطة:
```typescript
// في client/src/app/purchases/page.tsx
// استبدل المحتوى بالنسخة المبسطة
```

#### للعودة إلى النسخة الافتراضية:
```typescript
// استخدم الملف الأصلي
// client/src/app/purchases/page.tsx
```

### 📋 قائمة التحقق

- [ ] الباك إند يعمل على المنفذ الصحيح
- [ ] API الشركات يعمل (`/api/company`)
- [ ] المستخدم مسجل الدخول
- [ ] هناك شركات في قاعدة البيانات
- [ ] الصلاحيات صحيحة
- [ ] لا توجد أخطاء في Console
- [ ] الشبكة تعمل بشكل صحيح

### 🆘 إذا لم تحل المشكلة

1. **تحقق من الباك إند:**
   ```bash
   cd server
   npm run dev
   ```

2. **تحقق من الفرونت إند:**
   ```bash
   cd client
   npm run dev
   ```

3. **تحقق من قاعدة البيانات:**
   ```bash
   # تأكد من وجود شركات
   SELECT * FROM companies;
   ```

4. **تحقق من الصلاحيات:**
   ```bash
   # تأكد من أن المستخدم له صلاحيات
   SELECT * FROM users WHERE id = ?;
   ```

### 📞 الدعم الفني

إذا استمرت المشكلة، يرجى:
1. تصوير رسالة الخطأ
2. نسخ محتوى Console
3. وصف الخطوات التي قمت بها
4. التواصل مع فريق التطوير

---

**آخر تحديث:** ${new Date().toLocaleDateString('ar-LY')}
**الإصدار:** 1.0.0

