# ูุธุงู ุงููุจูุนุงุช ุงููุนูุฏุฉ - ุงูุชูุซูู ุงููุงูู

## ๐ ุงูููุฑุฉ ุงูุฃุณุงุณูุฉ:

### ุงูุณููุงุฑูู:
1. **ุดุฑูุฉ ุงูุชูุงุฒู (ุงูุดุฑูุฉ ุงูุฃู)** ูุฏููุง ุฃุตูุงู ููุฎุฒูู
2. **ุดุฑูุฉ ุงูุฅูุงุฑุงุช (ุงููุฑุน)** ุชุฑูุฏ ุจูุน ุฃุตูุงู ุงูุชูุงุฒู ููุนููู
3. **ุงูุนููู** ูุดุชุฑู ูู ุดุฑูุฉ ุงูุฅูุงุฑุงุช ุจูุงูุด ุฑุจุญ

### ุงูุนูููุงุช ุงูุชู ุชุญุฏุซ:
1. โ **ุฎุตู ุงููุฎุฒูู** ูู ุดุฑูุฉ ุงูุชูุงุฒู (ุงูุฃู)
2. โ **ูุงุชูุฑุฉ ุจูุน ุขุฌู** ูู ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช (ุฏุงุฆูุงู ุขุฌู)
3. โ **ูุงุชูุฑุฉ ุจูุน ููุนููู** ูู ุงูุฅูุงุฑุงุช โ ุงูุนููู (ููุฏู ุฃู ุขุฌู ุญุณุจ ุงูุงุฎุชูุงุฑ)

---

## ๐ ุชุฏูู ุงูุนูููุฉ:

```
โโโโโโโโโโโโโโโโโโโ
โ  ุดุฑูุฉ ุงูุชูุงุฒู   โ (ุงูุดุฑูุฉ ุงูุฃู)
โ   (ุงููุฎุฒูู)     โ
โโโโโโโโโโฌโโโโโโโโโ
         โ 1. ุฎุตู ุงููุฎุฒูู
         โ 2. ูุงุชูุฑุฉ ุจูุน ุขุฌู
         โ
โโโโโโโโโโโโโโโโโโโ
โ  ุดุฑูุฉ ุงูุฅูุงุฑุงุช  โ (ุงููุฑุน)
โ   (ุงููุณูุท)      โ
โโโโโโโโโโฌโโโโโโโโโ
         โ 3. ูุงุชูุฑุฉ ุจูุน (ููุฏู/ุขุฌู)
         โ    + ูุงูุด ุงูุฑุจุญ
         โ
โโโโโโโโโโโโโโโโโโโ
โ     ุงูุนููู      โ
โโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ ุงูุญููู ุงููุทููุจุฉ:

### ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ:
1. **ุงูุนููู** - ูู ูุงุฆูุฉ ุงูุนููุงุก
2. **ุงูุดุฑูุฉ ุงูุฃู** - ุดุฑูุฉ ุงูุชูุงุฒู (ูุตุฏุฑ ุงูุจุถุงุนุฉ)
3. **ูุงูุด ุงูุฑุจุญ** - ูุณุจุฉ ูุฆููุฉ (ูุซูุงู 20%)
4. **ููุน ูุงุชูุฑุฉ ุงูุนููู** - ููุฏู ุฃู ุขุฌู โญ **ุฌุฏูุฏ**
5. **ุทุฑููุฉ ุงูุฏูุน** - ูุงุดุ ุญูุงูุฉุ ุจุทุงูุฉ โญ **ุฌุฏูุฏ**
6. **ุจููุฏ ุงููุงุชูุฑุฉ** - ุงูุฃุตูุงู ูุงููููุงุช

---

## ๐ ุงูููุงุชูุฑ ุงููููุดุฃุฉ:

### 1. ูุงุชูุฑุฉ ูู ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช:
```typescript
{
  companyId: parentCompanyId,        // ุดุฑูุฉ ุงูุชูุงุฒู
  customerId: customerId,            // ุงูุนููู (ููุฑุจุท)
  invoiceNumber: "PR-1-1234567890",
  total: parentSaleTotal,            // ุงูุณุนุฑ ุงูุฃุตูู
  saleType: "CREDIT",                // ุฏุงุฆูุงู ุขุฌู
  paymentMethod: "CASH",             // ุงูุชุฑุงุถู
  paidAmount: 0,                     // ูู ููุฏูุน ุจุนุฏ
  remainingAmount: parentSaleTotal,  // ุงููุจูุบ ุงููุชุจูู
  isFullyPaid: false                 // ุบูุฑ ูุฏููุน
}
```

### 2. ูุงุชูุฑุฉ ูู ุงูุฅูุงุฑุงุช โ ุงูุนููู:
```typescript
{
  companyId: branchCompanyId,        // ุดุฑูุฉ ุงูุฅูุงุฑุงุช
  customerId: customerId,            // ุงูุนููู
  invoiceNumber: "BR-2-1234567890",
  total: customerSaleTotal,          // ุงูุณุนุฑ + ูุงูุด ุงูุฑุจุญ
  saleType: customerSaleType,        // ููุฏู ุฃู ุขุฌู โญ
  paymentMethod: customerPaymentMethod, // ูุงุด/ุญูุงูุฉ/ุจุทุงูุฉ โญ
  paidAmount: (ููุฏู) ? total : 0,   // ุญุณุจ ุงูููุน
  remainingAmount: (ุขุฌู) ? total : 0,
  isFullyPaid: (ููุฏู) ? true : false
}
```

---

## ๐ง ุงูุชุญุฏูุซุงุช ุงููุทุจูุฉ:

### 1. **Types** (Frontend & Backend):
```typescript
interface CreateComplexInterCompanySaleRequest {
  customerId: number;
  branchCompanyId: number;
  parentCompanyId: number;
  lines: ComplexInterCompanySaleLine[];
  profitMargin?: number;
  customerSaleType: 'CASH' | 'CREDIT';      // โญ ุฌุฏูุฏ
  customerPaymentMethod: 'CASH' | 'BANK' | 'CARD'; // โญ ุฌุฏูุฏ
}
```

### 2. **Service Logic**:
```typescript
// ูู ComplexInterCompanySaleService.ts
const customerSaleType = data.customerSaleType || 'CASH';
const customerPaymentMethod = data.customerPaymentMethod || 'CASH';
const customerPaidAmount = customerSaleType === 'CASH' ? customerSaleTotal : 0;
const customerRemainingAmount = customerSaleType === 'CASH' ? 0 : customerSaleTotal;
const customerIsFullyPaid = customerSaleType === 'CASH';
```

### 3. **UI Components**:
```tsx
{/* ููุน ูุงุชูุฑุฉ ุงูุนููู */}
<select value={customerSaleType} onChange={...}>
  <option value="CASH">ููุฏู</option>
  <option value="CREDIT">ุขุฌู</option>
</select>

{/* ุทุฑููุฉ ุงูุฏูุน */}
<select value={customerPaymentMethod} onChange={...}>
  <option value="CASH">ูุงุด</option>
  <option value="BANK">ุญูุงูุฉ ูุตุฑููุฉ</option>
  <option value="CARD">ุจุทุงูุฉ ูุตุฑููุฉ</option>
</select>
```

---

## ๐ ุงููููุงุช ุงููุญุฏุซุฉ:

### Frontend:
1. โ `/client/src/state/complexInterCompanySalesApi.ts` - ุฅุถุงูุฉ ุงูุญููู ุงูุฌุฏูุฏุฉ
2. โ `/client/src/app/complex-inter-company-sales/page.tsx` - ุฅุถุงูุฉ UI ููุญููู
3. โ `/client/src/state/complexInterCompanySalesSlice.ts` - Redux slice

### Backend:
4. โ `/server/src/services/ComplexInterCompanySaleService.ts` - ุชุญุฏูุซ ุงูููุทู
5. โ `/server/src/routes/complexInterCompanySaleRoutes.ts` - ุงููุณุงุฑุงุช
6. โ `/server/src/controllers/ComplexInterCompanySaleController.ts` - ุงููุนุงูุฌ

---

## ๐งช ููููุฉ ุงูุงุฎุชุจุงุฑ:

### 1. ุฅูุดุงุก ุนูููุฉ ุจูุน ููุฏูุฉ:
```
1. ุงุฎุชุฑ ุงูุนููู
2. ุงุฎุชุฑ ุงูุดุฑูุฉ ุงูุฃู (ุงูุชูุงุฒู)
3. ุญุฏุฏ ูุงูุด ุงูุฑุจุญ (20%)
4. ููุน ุงููุงุชูุฑุฉ: ููุฏู
5. ุทุฑููุฉ ุงูุฏูุน: ูุงุด
6. ุฃุถู ุงูุจููุฏ
7. ุงุญูุธ
```

**ุงููุชูุฌุฉ**:
- โ ูุงุชูุฑุฉ ุขุฌู ูู ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช
- โ ูุงุชูุฑุฉ ููุฏูุฉ ูู ุงูุฅูุงุฑุงุช โ ุงูุนููู (ูุฏููุนุฉ ุจุงููุงูู)

### 2. ุฅูุดุงุก ุนูููุฉ ุจูุน ุขุฌูุฉ:
```
1. ุงุฎุชุฑ ุงูุนููู
2. ุงุฎุชุฑ ุงูุดุฑูุฉ ุงูุฃู (ุงูุชูุงุฒู)
3. ุญุฏุฏ ูุงูุด ุงูุฑุจุญ (25%)
4. ููุน ุงููุงุชูุฑุฉ: ุขุฌู
5. ุทุฑููุฉ ุงูุฏูุน: ุญูุงูุฉ ูุตุฑููุฉ
6. ุฃุถู ุงูุจููุฏ
7. ุงุญูุธ
```

**ุงููุชูุฌุฉ**:
- โ ูุงุชูุฑุฉ ุขุฌู ูู ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช
- โ ูุงุชูุฑุฉ ุขุฌูุฉ ูู ุงูุฅูุงุฑุงุช โ ุงูุนููู (ุบูุฑ ูุฏููุนุฉ)

---

## โ ุงููููุฒุงุช:

1. **ูุฑููุฉ ูู ููุน ุงููุงุชูุฑุฉ**: ููุฏู ุฃู ุขุฌู
2. **ุฎูุงุฑุงุช ุฏูุน ูุชุนุฏุฏุฉ**: ูุงุดุ ุญูุงูุฉุ ุจุทุงูุฉ
3. **ุญุณุงุจ ุชููุงุฆู**: ูููุจุงูุบ ุงููุฏููุนุฉ ูุงููุชุจููุฉ
4. **ุฎุตู ูุฎุฒูู ุฏููู**: ูู ุงูุดุฑูุฉ ุงูุฃู
5. **ููุงุชูุฑ ูููุตูุฉ**: ููุดุฑูุฉ ุงูุฃู ูุงููุฑุน
6. **ูุงูุด ุฑุจุญ ูุฑู**: ูุงุจู ููุชุนุฏูู

---

## ๐ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู!

ุฌููุน ุงููุชุทูุจุงุช ุชู ุชุทุจูููุง:
- โ ูุงุชูุฑุฉ ุจูุน ุขุฌู ูู ุงูุชูุงุฒู โ ุงูุฅูุงุฑุงุช
- โ ูุงุชูุฑุฉ ุจูุน ูู ุงูุฅูุงุฑุงุช โ ุงูุนููู (ููุฏู/ุขุฌู)
- โ ุฎุงูุฉ ููุน ุงููุงุชูุฑุฉ
- โ ุฎุงูุฉ ุทุฑููุฉ ุงูุฏูุน
- โ ูุงูุด ุงูุฑุจุญ
- โ ุฎุตู ุงููุฎุฒูู
