# ุฅุตูุงุญ ุญุณุงุจ ุฅุญุตุงุฆูุงุช ุงูุฃุตูุงู

## ๐ ุงููุดููุฉ ุงูุฃุณุงุณูุฉ:

ูุงู ุงูุญุณุงุจ **ุฎุงุทุฆุงู ุชูุงูุงู** ูุฃูู ูุญุณุจ ุนุฏุฏ **ุณุฌูุงุช ุงููุฎุฒูู** ูููุณ ุนุฏุฏ **ุงูููุชุฌุงุช ุงููุฑูุฏุฉ**.

### ูุซุงู ุนูู ุงููุดููุฉ:
```
ูุฏูู 10 ููุชุฌุงุช:
- ููุชุฌ A: ูู ูุฎุฒูู ูู ุดุฑูุฉ 1 (5 ุตูุงุฏูู) ูุดุฑูุฉ 2 (3 ุตูุงุฏูู)
- ููุชุฌ B: ูู ูุฎุฒูู ูู ุดุฑูุฉ 1 (0 ุตูุงุฏูู)
- ููุชุฌ C: ููุณ ูู ุณุฌู ูุฎุฒูู ุฃุตูุงู
- ... ุฅูุฎ

ุงูุญุณุงุจ ุงููุฏูู ุงูุฎุงุทุฆ:
- productsWithStock = ุนุฏุฏ ุณุฌูุงุช ุงููุฎุฒูู ุงูุชู boxes > 0 = 2 ุณุฌู
- productsWithoutStock = 10 - 2 = 8 โ ุฎุทุฃ!

ุงูุญุณุงุจ ุงูุตุญูุญ:
- productsWithStock = ุนุฏุฏ ุงูููุชุฌุงุช ุงููุฑูุฏุฉ ุงูุชู ููุง boxes > 0 = 1 ููุชุฌ (A ููุท)
- productsWithoutStock = 9 ููุชุฌุงุช โ ุตุญูุญ!
```

---

## โ ุงูุญู ุงููุทุจู:

### 1. ุญุณุงุจ ุงูููุชุฌุงุช ุงูุชู ููุง ูุฎุฒูู:
```typescript
// ุงูุญุตูู ุนูู ุงูููุชุฌุงุช ุงููุฑูุฏุฉ ุงูุชู ููุง boxes > 0
const stocksWithPositiveBoxes = await this.prisma.stock.findMany({
  where: {
    ...(isSystemUser !== true && { companyId: userCompanyId }),
    boxes: { gt: 0 }
  },
  select: { productId: true },
  distinct: ['productId']  // โ ุงูููุชุงุญ: distinct ููุญุตูู ุนูู ููุชุฌุงุช ูุฑูุฏุฉ
});

const productsWithStock = stocksWithPositiveBoxes.length;
```

### 2. ุญุณุงุจ ุงูููุชุฌุงุช ุจุฏูู ูุฎุฒูู:
```typescript
// ุงูููุชุฌุงุช ุงูุชู ููุง boxes = 0
const stocksWithZeroBoxes = await this.prisma.stock.findMany({
  where: {
    ...(isSystemUser !== true && { companyId: userCompanyId }),
    boxes: { lte: 0 }
  },
  select: { productId: true },
  distinct: ['productId']
});

// ุฌููุน ุงูููุชุฌุงุช ุงูุชู ููุง ุณุฌู ูุฎุฒูู
const productsWithStockRecords = await this.prisma.stock.findMany({
  where: {
    ...(isSystemUser !== true && { companyId: userCompanyId })
  },
  select: { productId: true },
  distinct: ['productId']
});

const productIdsWithStock = new Set(productsWithStockRecords.map(s => s.productId));

// ุงูููุชุฌุงุช ุจุฏูู ูุฎุฒูู = ุงูุชู ููุง boxes = 0 + ุงูุชู ููุณ ููุง ุณุฌู ูุฎุฒูู ุฃุตูุงู
const productsWithoutStock = stocksWithZeroBoxes.length + (totalProducts - productIdsWithStock.size);
```

---

## ๐ ุงููุฑู ุจูู ุงูุญุณุงุจ ุงููุฏูู ูุงูุฌุฏูุฏ:

### ุงูุญุณุงุจ ุงููุฏูู (ุฎุงุทุฆ):
```typescript
// ูุญุณุจ ุนุฏุฏ ุงูุณุฌูุงุช ูููุณ ุงูููุชุฌุงุช
const productsWithStock = await this.prisma.stock.count({
  where: { boxes: { gt: 0 } }
});
// โ ุฅุฐุง ูุงู ุงูููุชุฌ ูู ูุฎุฒูู ูู ุดุฑูุชููุ ููุญุณุจ ูุฑุชูู!

const productsWithoutStock = totalProducts - productsWithStock;
// โ ุทุฑุญ ุฎุงุทุฆ ูุฃู ุงูุฃุฑูุงู ุบูุฑ ูุชุทุงุจูุฉ
```

### ุงูุญุณุงุจ ุงูุฌุฏูุฏ (ุตุญูุญ):
```typescript
// ูุญุณุจ ุนุฏุฏ ุงูููุชุฌุงุช ุงููุฑูุฏุฉ
const stocksWithPositiveBoxes = await this.prisma.stock.findMany({
  select: { productId: true },
  distinct: ['productId']  // โ distinct
});
// โ ูู ููุชุฌ ููุญุณุจ ูุฑุฉ ูุงุญุฏุฉ ููุท

const productsWithStock = stocksWithPositiveBoxes.length;
// โ ุนุฏุฏ ุตุญูุญ ููููุชุฌุงุช ุงููุฑูุฏุฉ
```

---

## ๐งช ุฃูุซูุฉ ุนูู ุงูุญุณุงุจ ุงูุตุญูุญ:

### ูุซุงู 1: ุดุฑูุฉ ูุงุญุฏุฉ
```
ุฅุฌูุงูู ุงูุฃุตูุงู: 100
- 60 ุตูู ููู ูุฎุฒูู > 0
- 30 ุตูู ููู ูุฎุฒูู = 0
- 10 ุฃุตูุงู ุจุฏูู ุณุฌู ูุฎุฒูู

ุงููุชูุฌุฉ:
โ ุฃุตูุงู ุจูุฎุฒูู: 60
โ ุฃุตูุงู ุจุฏูู ูุฎุฒูู: 40 (30 + 10)
```

### ูุซุงู 2: ุนุฏุฉ ุดุฑูุงุช (System User)
```
ุฅุฌูุงูู ุงูุฃุตูุงู: 100
- ุตูู A: ูู ูุฎุฒูู ูู ุดุฑูุฉ 1 (5) ูุดุฑูุฉ 2 (3) โ ููุญุณุจ ูุฑุฉ ูุงุญุฏุฉ
- ุตูู B: ูู ูุฎุฒูู ูู ุดุฑูุฉ 1 (0) ูุดุฑูุฉ 2 (10) โ ูู ูุฎุฒูู
- ุตูู C: ูู ูุฎุฒูู ูู ุดุฑูุฉ 1 (0) ูุดุฑูุฉ 2 (0) โ ุจุฏูู ูุฎุฒูู
- ุตูู D: ููุณ ูู ุณุฌู ูุฎุฒูู โ ุจุฏูู ูุฎุฒูู

ุงููุชูุฌุฉ:
โ ูู ุตูู ููุญุณุจ ูุฑุฉ ูุงุญุฏุฉ ููุท
โ ุงูุญุณุงุจ ุฏููู ูููุทูู
```

---

## ๐ ุงูููู ุงููุญุฏุซ:
- โ `/server/src/services/ProductService.ts` - ุฏุงูุฉ `getProductStats()`

---

## โจ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

### ูุจู ุงูุฅุตูุงุญ:
```
ุฅุฌูุงูู ุงูุฃุตูุงู: 100
ุฃุตูุงู ุจูุฎุฒูู: 150 โ (ุฃูุซุฑ ูู ุงูุฅุฌูุงูู!)
ุฃุตูุงู ุจุฏูู ูุฎุฒูู: -50 โ (ุฑูู ุณุงูุจ!)
```

### ุจุนุฏ ุงูุฅุตูุงุญ:
```
ุฅุฌูุงูู ุงูุฃุตูุงู: 100
ุฃุตูุงู ุจูุฎุฒูู: 60 โ
ุฃุตูุงู ุจุฏูู ูุฎุฒูู: 40 โ
```

---

## ๐ฏ ุงูููุงุฆุฏ:

1. โ **ุญุณุงุจ ุฏููู**: ูู ููุชุฌ ููุญุณุจ ูุฑุฉ ูุงุญุฏุฉ ููุท
2. โ **ูุง ุฃุฑูุงู ุณุงูุจุฉ**: ุงูููุทู ุตุญูุญ
3. โ **ูุนูู ูุน ุนุฏุฉ ุดุฑูุงุช**: ููู System Users
4. โ **ุฃุฏุงุก ุฌูุฏ**: ุงุณุชุฎุฏุงู `distinct` ุจุฏูุงู ูู queries ูุนูุฏุฉ

ุงููุธุงู ุงูุขู ูุญุณุจ ุงูุฅุญุตุงุฆูุงุช ุจุดูู ุตุญูุญ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช! ๐
