# ุงูุญู ุงููุงูู ููููุงุชูุฑ ุงููุจุฏุฆูุฉ - ุงููุนุงููุฉ ูุงูุทุจุงุนุฉ ูุงูุชุฑุญูู

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅููุงู ูุธุงู ุงูููุงุชูุฑ ุงููุจุฏุฆูุฉ ุจุงููุงูู ูุน ุญู ูุดููุฉ ุงููุนุงููุฉ ูุงูุทุจุงุนุฉ ุงูุชู ูุงูุช ุชุนุฑุถ ูุนูููุงุช ุฎุงุทุฆุฉ.

## โ ุงููููุงุช ุงูููุดุฃุฉ ูุงููุนุฏูุฉ

### 1. Frontend Components

#### `@/client/src/components/sales/InvoicePrint.tsx` (ูุนุฏู)
- **ุงูุชุนุฏูู**: ุฅุถุงูุฉ ุฏุนู ููููุงุชูุฑ ุงููุจุฏุฆูุฉ
- **ุงููุนุงูู ุงูุฌุฏูุฏ**: `isProvisional?: boolean`
- **ุงููุธููุฉ**: ุนุฑุถ "ูุงุชูุฑุฉ ูุจูุนุงุช ูุจุฏุฆูุฉ" ู "ููุน ุงููุงุชูุฑุฉ: ูุจุฏุฆูุฉ" ุจุฏูุงู ูู ููุน ุงูุจูุน ูุทุฑููุฉ ุงูุฏูุน

```tsx
<InvoicePrint 
  sale={provisionalSale} 
  isProvisional={true}  // ููููุงุชูุฑ ุงููุจุฏุฆูุฉ
/>
```

#### `@/client/src/components/provisional-sales/ProvisionalSalePrintModal.tsx` (ุฌุฏูุฏ)
- **ุงููุธููุฉ**: ููุฏุงู ุทุจุงุนุฉ ูุฎุตุต ููููุงุชูุฑ ุงููุจุฏุฆูุฉ
- **ุงููููุฒุงุช**:
  - ูุนุงููุฉ ุงููุงุชูุฑุฉ ูุจู ุงูุทุจุงุนุฉ
  - ุฑุณุงูุฉ ุชูุถูุญูุฉ ุนู ุญุงูุฉ ุงููุงุชูุฑุฉ ุงููุจุฏุฆูุฉ
  - ุชุตููู ูููุฒ ุจุงูููู ุงูุจุฑุชูุงูู
  - ุทุจุงุนุฉ ูุจุงุดุฑุฉ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ

### 2. API Layer

#### `@/client/src/state/provisionalSalesApi.ts` (ุฌุฏูุฏ)
- **ุงููุธุงุฆู ุงููุชุงุญุฉ**:
  - `useGetProvisionalSalesQuery` - ุฌูุจ ูุงุฆูุฉ ุงูููุงุชูุฑ
  - `useGetProvisionalSaleByIdQuery` - ุฌูุจ ูุงุชูุฑุฉ ูุงุญุฏุฉ
  - `useCreateProvisionalSaleMutation` - ุฅูุดุงุก ูุงุชูุฑุฉ
  - `useUpdateProvisionalSaleMutation` - ุชุญุฏูุซ ูุงุชูุฑุฉ
  - `useDeleteProvisionalSaleMutation` - ุญุฐู ูุงุชูุฑุฉ
  - `useUpdateProvisionalSaleStatusMutation` - ุชุญุฏูุซ ุงูุญุงูุฉ
  - `useConvertProvisionalSaleToSaleMutation` - ุชุฑุญูู ุฅูู ูุงุชูุฑุฉ ุนุงุฏูุฉ

### 3. Pages

#### `@/client/src/app/provisional-sales/page.tsx` (ุฌุฏูุฏ)
- **ุงููุธููุฉ**: ุตูุญุฉ ูุงููุฉ ูุฅุฏุงุฑุฉ ุงูููุงุชูุฑ ุงููุจุฏุฆูุฉ
- **ุงููููุฒุงุช**:
  - ุนุฑุถ ูุงุฆูุฉ ุงูููุงุชูุฑ ุงููุจุฏุฆูุฉ
  - ุงูุจุญุซ ูุงูููุชุฑุฉ ุญุณุจ ุงูุญุงูุฉ
  - ุทุจุงุนุฉ ุงูููุงุชูุฑ ุงููุจุฏุฆูุฉ
  - ุชุฑุญูู ุงูููุงุชูุฑ ุฅูู ููุงุชูุฑ ูุจูุนุงุช ุนุงุฏูุฉ
  - ุนุฑุถ ุญุงูุฉ ุงููุงุชูุฑุฉ (ูุณูุฏุฉุ ูุนููุฉุ ูุนุชูุฏุฉุ ูุฑุญูุฉุ ููุบูุฉ)

### 4. Redux Store

#### `@/client/src/app/redux.tsx` (ูุนุฏู)
- **ุงูุชุนุฏูู**: ุฅุถุงูุฉ `provisionalSalesApi` ุฅูู Store
- **ุงูุฅุถุงูุงุช**:
  - `provisionalSalesApi.reducer`
  - `provisionalSalesApi.middleware`

## ๐ ุณูุฑ ุงูุนูู ุงููุงูู

### 1. ุฅูุดุงุก ูุงุชูุฑุฉ ูุจุฏุฆูุฉ
```tsx
const [createSale] = useCreateProvisionalSaleMutation();

await createSale({
  companyId: 2,
  customerId: 123,
  invoiceNumber: 'INV-001',
  status: 'DRAFT',
  lines: [
    { productId: 1, qty: 10, unitPrice: 50 }
  ]
});
```

### 2. ูุนุงููุฉ ูุทุจุงุนุฉ ุงููุงุชูุฑุฉ ุงููุจุฏุฆูุฉ
- **ุงูุทุจุงุนุฉ ุชุนุฑุถ**:
  - โ ุงูุนููุงู: "ูุงุชูุฑุฉ ูุจูุนุงุช ูุจุฏุฆูุฉ" (ุจุฑุชูุงูู)
  - โ ููุน ุงููุงุชูุฑุฉ: **ูุจุฏุฆูุฉ** (ุจุฑุชูุงูู ูุนุฑูุถ)
  - โ ูุง ูุชู ุนุฑุถ ููุน ุงูุจูุน ุฃู ุทุฑููุฉ ุงูุฏูุน

### 3. ุชุฑุญูู ุงููุงุชูุฑุฉ ุงููุจุฏุฆูุฉ ุฅูู ูุงุชูุฑุฉ ุนุงุฏูุฉ
```tsx
const [convertToSale] = useConvertProvisionalSaleToSaleMutation();

await convertToSale({
  id: provisionalSaleId,
  data: {
    saleType: 'CASH',      // ุฃู 'CREDIT'
    paymentMethod: 'CASH'  // ุฃู 'BANK' ุฃู 'CARD'
  }
});
```

**ุงููุชูุฌุฉ**:
- โ ูุชู ุฅูุดุงุก ูุงุชูุฑุฉ ูุจูุนุงุช ุนุงุฏูุฉ ุฌุฏูุฏุฉ
- โ ุงููุงุชูุฑุฉ ุงูุฌุฏูุฏุฉ ุชุญุชูู ุนูู `saleType` ู `paymentMethod`
- โ ุงููุงุชูุฑุฉ ุงููุจุฏุฆูุฉ ุชูุญุฏุซ ุฅูู ุญุงูุฉ `CONVERTED`
- โ ูุชู ุฑุจุท ุงููุงุชูุฑุชูู ูุนุงู (`convertedSaleId`)

### 4. ุงูุชุญุฏูุซุงุช ุชูุนูุณ ุชููุงุฆูุงู
- โ ุนูุฏ ุงูุชุฑุญูู ูู ุดุงุดุฉ ุงููุญุงุณุจุ ุชุธูุฑ ุงูุชุญุฏูุซุงุช ูู ุดุงุดุฉ ุงููุจูุนุงุช
- โ ุงุณุชุฎุฏุงู Redux RTK Query ูุถูู ุชุญุฏูุซ ุงูุจูุงูุงุช ุชููุงุฆูุงู
- โ ุงูู cache ูุชู ุชุญุฏูุซู ุนุจุฑ `invalidatesTags`

## ๐ ุญุงูุงุช ุงููุงุชูุฑุฉ ุงููุจุฏุฆูุฉ

| ุงูุญุงูุฉ | ุงููุตู | ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ |
|--------|-------|-------------------|
| `DRAFT` | ูุณูุฏุฉ | ุชุนุฏููุ ุญุฐูุ ุชุฑุญูู |
| `PENDING` | ูุนููุฉ | ุชุนุฏููุ ุงุนุชูุงุฏุ ุฅูุบุงุกุ ุชุฑุญูู |
| `APPROVED` | ูุนุชูุฏุฉ | ุชุฑุญููุ ุฅูุบุงุก |
| `CONVERTED` | ูุฑุญูุฉ | ุนุฑุถ ููุท (ูุน ุฑุงุจุท ูููุงุชูุฑุฉ ุงูุนุงุฏูุฉ) |
| `CANCELLED` | ููุบูุฉ | ุนุฑุถ ููุท |

## ๐ ุฎุตู ุงููุฎุฒูู

**ููู ุฌุฏุงู**: ุฎุตู ุงููุฎุฒูู ูุชู ููุท ุนูุฏ ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ ุงูุนุงุฏูุฉ ูู ุงููุญุงุณุจ

1. โ **ูุง ูุชู ุฎุตู ุงููุฎุฒูู** ุนูุฏ ุฅูุดุงุก ุงููุงุชูุฑุฉ ุงููุจุฏุฆูุฉ
2. โ **ูุง ูุชู ุฎุตู ุงููุฎุฒูู** ุนูุฏ ุชุฑุญูู ุงููุงุชูุฑุฉ ุงููุจุฏุฆูุฉ
3. โ **ูุชู ุฎุตู ุงููุฎุฒูู** ููุท ุนูุฏ ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ ุงูุนุงุฏูุฉ

ูุฐุง ูุถูู:
- ุนุฏู ุฎุตู ุงููุฎุฒูู ูุฑุชูู
- ุฅููุงููุฉ ุฅูุบุงุก ุงููุงุชูุฑุฉ ุงููุจุฏุฆูุฉ ุฏูู ูุดุงูู
- ุณูุงู ุนูู ููุญุฏ ูุฌููุน ุฃููุงุน ุงูููุงุชูุฑ

## ๐จ ุงูุชุตููู ูุงูุฃููุงู

### ุงูููุงุชูุฑ ุงููุจุฏุฆูุฉ
- **ุงูููู ุงูุฃุณุงุณู**: ุจุฑุชูุงูู (`#f59e0b`)
- **ุงูุนููุงู**: "ูุงุชูุฑุฉ ูุจูุนุงุช ูุจุฏุฆูุฉ"
- **ููุน ุงููุงุชูุฑุฉ**: "ูุจุฏุฆูุฉ" (ุจุฑุชูุงูู ูุนุฑูุถ)

### ุงูููุงุชูุฑ ุงูุนุงุฏูุฉ
- **ุงูููู ุงูุฃุณุงุณู**: ุฃุฒุฑู (`#2563eb`)
- **ุงูุนููุงู**: "ูุงุชูุฑุฉ ูุจูุนุงุช"
- **ุงููุนูููุงุช**: ููุน ุงูุจูุน + ุทุฑููุฉ ุงูุฏูุน

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### ูุซุงู 1: ุตูุญุฉ ุงูููุงุชูุฑ ุงููุจุฏุฆูุฉ
```tsx
import { useGetProvisionalSalesQuery } from '@/state/provisionalSalesApi';
import { ProvisionalSalePrintModal } from '@/components/provisional-sales/ProvisionalSalePrintModal';

export default function ProvisionalSalesPage() {
  const { data } = useGetProvisionalSalesQuery({ page: 1, limit: 20 });
  
  return (
    <div>
      {data?.provisionalSales.map(sale => (
        <div key={sale.id}>
          <button onClick={() => handlePrint(sale)}>ุทุจุงุนุฉ</button>
          <button onClick={() => handleConvert(sale)}>ุชุฑุญูู</button>
        </div>
      ))}
    </div>
  );
}
```

### ูุซุงู 2: ุงูุชุฑุญูู ูู ุดุงุดุฉ ุงููุญุงุณุจ
```tsx
const [convertToSale] = useConvertProvisionalSaleToSaleMutation();

const handleConvert = async (provisionalSale) => {
  try {
    const result = await convertToSale({
      id: provisionalSale.id,
      data: {
        saleType: 'CASH',
        paymentMethod: 'CASH'
      }
    }).unwrap();
    
    console.log('ุชู ุงูุชุฑุญูู ุจูุฌุงุญ:', result);
    // ุงููุงุชูุฑุฉ ุงูุฌุฏูุฏุฉ ูุชุงุญุฉ ูู result.convertedSale
  } catch (error) {
    console.error('ูุดู ุงูุชุฑุญูู:', error);
  }
};
```

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงููุงุชูุฑุฉ ุงููุจุฏุฆูุฉ ุชุนุฑุถ ููุน ุงูุจูุน ูุทุฑููุฉ ุงูุฏูุน
**ุงูุญู**: ุชุฃูุฏ ูู ุชูุฑูุฑ `isProvisional={true}` ููููู `InvoicePrint`

### ุงููุดููุฉ: ุงูุชุญุฏูุซุงุช ูุง ุชุธูุฑ ูู ุดุงุดุฉ ุงููุจูุนุงุช
**ุงูุญู**: ุชุฃูุฏ ูู ุงุณุชุฎุฏุงู `refetch()` ุฃู ุงูุงุนุชูุงุฏ ุนูู `invalidatesTags` ูู RTK Query

### ุงููุดููุฉ: ุฎุตู ุงููุฎุฒูู ูุฑุชูู
**ุงูุญู**: ุงููุธุงู ูุตูู ูุฎุตู ุงููุฎุฒูู ูุฑุฉ ูุงุญุฏุฉ ููุท ุนูุฏ ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ ุงูุนุงุฏูุฉ

## ๐ ุงููููุงุช ุงููุฑุฌุนูุฉ

1. **ุงูุชูุซูู ุงูุฃุณุงุณู**: `/PROVISIONAL_SALES_PRINT_FIX.md`
2. **ูุฐุง ุงูููู**: `/PROVISIONAL_SALES_COMPLETE_SOLUTION.md`
3. **Backend API**: `/server/src/services/ProvisionalSalesService.ts`
4. **Frontend API**: `/client/src/state/provisionalSalesApi.ts`

## โจ ุงูุฎูุงุตุฉ

ุชู ุฅููุงู ูุธุงู ุงูููุงุชูุฑ ุงููุจุฏุฆูุฉ ุจุงููุงูู ูุน:

โ **ูุนุงููุฉ ูุทุจุงุนุฉ ุตุญูุญุฉ** - ุชุนุฑุถ "ูุจุฏุฆูุฉ" ุจุฏูุงู ูู ููุน ุงูุจูุน ูุทุฑููุฉ ุงูุฏูุน
โ **ุชุฑุญูู ุขูู** - ูุน ุชุญุฏูุฏ ููุน ุงูุจูุน ูุทุฑููุฉ ุงูุฏูุน ุนูุฏ ุงูุชุฑุญูู
โ **ุชุญุฏูุซุงุช ุชููุงุฆูุฉ** - ุฌููุน ุงูุชุบููุฑุงุช ุชูุนูุณ ููุฑุงู ูู ุฌููุน ุงูุดุงุดุงุช
โ **ุฎุตู ูุฎุฒูู ุขูู** - ูุชู ูุฑุฉ ูุงุญุฏุฉ ููุท ุนูุฏ ุงุนุชูุงุฏ ุงููุงุชูุฑุฉ ุงูุนุงุฏูุฉ
โ **ูุงุฌูุฉ ูุณุชุฎุฏู ูุงููุฉ** - ุตูุญุฉ ุฅุฏุงุฑุฉ + ููุฏุงู ุทุจุงุนุฉ + ููุฏุงู ุชุฑุญูู

**ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู ุงูููุฑู!** ๐
