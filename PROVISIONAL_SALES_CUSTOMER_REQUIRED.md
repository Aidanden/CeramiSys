# تحديث: العميل إلزامي في الفواتير المبدئية

## التاريخ
14 أكتوبر 2025

## الملخص
تم تعديل صفحة الفواتير المبدئية لجعل **اختيار العميل إلزامياً** قبل إمكانية إضافة أي بنود للفاتورة.

## التغييرات المطبقة

### 1. التحقق من العميل في دالة الحفظ
```typescript
// التحقق من اختيار العميل أولاً
if (!saleForm.customerId) {
  error('يجب اختيار العميل أولاً قبل إضافة البنود');
  return;
}
```

### 2. تحديث حقل العميل
- **التسمية**: تم تغيير "العميل (اختياري)" إلى "العميل *"
- **التصميم**: إضافة حدود حمراء وخلفية حمراء فاتحة عند عدم اختيار العميل
- **الخيار الافتراضي**: تم تغييره إلى "-- يجب اختيار العميل أولاً --"
- **التحقق**: إضافة `required` attribute
- **رسالة تحذير**: إضافة رسالة تحذير أسفل الحقل عند عدم الاختيار

### 3. تعطيل زر "إضافة بند"
```typescript
disabled={!saleForm.customerId || filteredProducts.length === 0}
```
- لا يمكن إضافة بنود إلا بعد اختيار العميل
- إضافة tooltip يوضح السبب: "يجب اختيار العميل أولاً"
- إضافة رسالة تحذير بجانب الزر: "⚠️ اختر العميل أولاً"

### 4. تعطيل زر الحفظ
```typescript
disabled={isCreating || !saleForm.customerId || saleForm.lines.length === 0}
```
- الزر معطل إذا لم يتم اختيار العميل
- تحديث نص الزر ليعكس الحالة:
  - "اختر العميل أولاً" - إذا لم يتم اختيار عميل
  - "أضف بند واحد على الأقل" - إذا لم تكن هناك بنود
  - "حفظ الفاتورة المبدئية" - عند الجاهزية

### 5. تحديث العنوان
- إزالة "- تم التحديث 🔥" من العنوان
- إزالة "العميل اختياري الآن!" من الوصف

### 6. تبسيط كود الإرسال
- إزالة الكود الذي يحذف `customerId` إذا لم يتم تحديده
- العميل الآن إلزامي دائماً

## سلوك النظام

### قبل اختيار العميل:
1. ✅ حقل العميل يظهر بحدود حمراء
2. ✅ رسالة تحذير تظهر أسفل حقل العميل
3. ❌ زر "إضافة بند" معطل
4. ❌ زر "حفظ الفاتورة" معطل مع نص "اختر العميل أولاً"

### بعد اختيار العميل:
1. ✅ حقل العميل يظهر بشكل طبيعي
2. ✅ زر "إضافة بند" مفعّل
3. ✅ يمكن إضافة البنود
4. ✅ زر الحفظ يصبح مفعّلاً بعد إضافة بند واحد على الأقل

## الملفات المعدلة
- `/client/src/app/provisional-sales/page.tsx`

## الاختبار المطلوب
1. ✅ التحقق من عدم إمكانية إضافة بنود قبل اختيار العميل
2. ✅ التحقق من ظهور رسائل التحذير المناسبة
3. ✅ التحقق من عدم إمكانية الحفظ بدون عميل
4. ✅ التحقق من عمل النظام بشكل طبيعي بعد اختيار العميل

## ملاحظات
- هذا التغيير يعكس التعديل السابق الذي جعل العميل اختيارياً
- العميل الآن **إلزامي** في جميع الفواتير المبدئية
- التصميم يوضح للمستخدم بشكل واضح أن العميل مطلوب
